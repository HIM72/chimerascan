#summary How to run chimerascan
#labels Featured

= Before getting started =

  # Ensure that your chimerascan installation is complete (see [Installation]).
  # Build an index using the chimerascan indexer (see [Installation]).

= Your first run =

We have tested `chimerascan` using the UCSC genome version hg19 and the corresponding UCSC known gene transcriptome annotations.  For the following example, we will assume your created an index (using the `chimerascan_index.py` script) with an output directory `<INDEX_DIR>`.  `Chimerascan` comes packages with some handy test FASTQ files that we prepared from known chimeras.  These FASTQ files contain _solexa_ type quality scores. These are located in the `/tests` subdirectory within the chimerascan download directory. You should first try chimerascan on some of these to ensure that your setup is working.  Note that the test reads provided are from *human* and only compatible with indexes build from the human genome.

== Finding the TMPRSS2-ERG gene fusion in prostate cancer ==

  # Assume you downloaded chimerascan to the directory `DOWNLOAD_DIR`
  # Assume you built the chimerascan index in the directory `INDEX_DIR`

To test chimerascan on the TMPRSS2-ERG discordant reads with the default parameters, run the following command:

{{{
python <INSTALL_DIR>/bin/chimerascan_run.py -v --quals solexa <INDEX_DIR> 
  <DOWNLOAD_DIR>/tests/vcap_pe_53bp/TMPRSS2-ERG_1.fq 
  <DOWNLOAD_DIR>/tests/vcap_pe_53bp/TMPRSS2-ERG_2.fq 
  t2erg_output_dir
}}}

For example, if I downloaded chimerascan to `/home/john/downloads/chimerascan`, and installed chimerascan to `/home/john/chimerascan` and built and index at '/home/john/chimerascan_hg19_ucsc_index', I could run chimerascan as follows:

{{{
$ /home/john/chimerascan/bin/chimerascan_run.py /home/john/chimerascan_hg19_ucsc_index /home/john/downloads/chimerascan/tests/vcap_pe_53bp/TMPRSS2-ERG_1.fq /home/john/downloads/chimerascan/tests/vcap_pe_53bp/TMPRSS2-ERG_2.fq t2erg_output_dir
}}}

== Logging messages ==

Chimerascan produces periodic logging messages during runtime.  Adding the `--verbose` option on the command line will show additional debugging messages. If all goes well, you will see the following message upon completion:

`2011-02-09 22:04:09,907 - root - INFO - Finished run.`

A successful chimerascan run will produce several output files.  Currently, the key output file is a tabular text file named *`chimeras.txt`*.

You can now proceed to look at the output.

== Output ==

The `chimeras.txt` file contains information about the chromosomal regions, transcript ids, genes, and statistics for each nominating chimera.  A full description of the output format is provided below:

|| *Column#* || *Name* || *Example* || *Description* ||
|| 1 || 5' chromosome || chr21 || Chromosome of 5' partner ||
|| 2 || 5' breakpoint position || 42880007 || Genomic position of breakpoint in 5' partner ||
|| 3 || 5' strand || - || Genomic strand of 5' partner ||
|| 4 || 3' chromosome || chr21 || Chromosome of 3' partner ||
|| 5 || 3' breakpoint position || 39817543 || Genomic position of breakpoint in 3' partner ||
|| 6 || 3' strand || - || Genomic strand of 3' partner ||
|| 7 || 5' transcript ids || uc002yzj.2 || Comma-delimited list of 5' transcript ids ||
|| 8 || 3' transcript ids || uc010gnw.2,uc010gnx.2,uc002yxb.2,uc002yxa.2,uc011ael.1,uc011aem.1,uc002yxc.3 || Comma-delimited list of 3' transcript ids ||
|| 9 || 5' genes || TMPRSS2 || Comma-delimited list of 5' genes ||
|| 10 || 3' genes || ERG || Comma-delimited list of 3' genes ||
|| 11 || chimera type || Intrachromosomal || describes chimera as one of several types, including "Read_Through", "Intrachromosomal", "Interchromosomal", and others ||
|| 12 || distance to 3' partner || -2802774 || distance from 5' to 3' chimera, or 'None' for interchromosomal chimeras ||
|| 13 || multimapping weighted fragments || 183.0 || a weighted count of fragments supporting chimera, where multimapping fragments are assigned fractional weights ||
|| 14 || total fragments || 183 || total number of fragments supporting chimera ||
|| 15 || spanning fragments || 68 || number of fragments spanning breakpoint junction ||
|| 16 || unique alignment positions || 132 || number unique read alignment positions ||
|| 17 || unique spanning alignment positions || 16 || number of unique breakpoint spanning alignment positions ||

== Creating an HTML page for easy viewing of the top candidates in a run ==

A new script, "chimerascan_html_table.py", is now provided that produces a sortable table of the top chimera candidates in a *chimeras.ranked.bedpe* file.  *NOTE: This script requires the Jinja2 python package to be installed, visit [http://jinja.pocoo.org/docs/intro/#installation] to install it*.  The script has two parameters: (1) a threshold for the empirical probability and (2) whether or not to include "read-through" chimeras in the output.

{{{
$ /home/john/chimerascan/bin/chimerascan_html.py -h
Usage: chimerascan_html_table.py [options] <chimeras.ranked.bedpe>

Options:
  -h, --help            show this help message and exit
  -o OUTPUT_FILE        output file [default=stdout]
  --empirical-prob=EMPIRICAL_PROB
                        probability threshold (0-1) [default=0.6]
  --read-throughs       include read-through chimeras in output
                        [default=False]
}}}

For example:
{{{
/home/john/chimerascan/bin/chimerascan_html.py --empirical-prob 1.0 -o myfile.html chimeras.ranked.bedpe
}}}

The output file, *myfile.html* will be written.  You can open it in your favorite web browser.  Javascript should be enabled to facilitate the sorting feature.

= `Chimerascan` command-line options =

*These may change in subsequent release of `chimerascan` and this wiki page may lag the software*. Please run `chimerascan_run.py` with the "-h" option to view the most recent list of options.

Many of chimerascan's options are directly passed to `Bowtie`.  Therefore, users should refer to Bowtie's manual pages for a full explanation of these parameters.

{{{
$ <INSTALL_DIR>/bin/chimerascan_run.py --help
Usage: chimerascan_run.py [options] [--config <config_file>  | <index> <mate1.fq> <mate2.fq> <output_dir>]

Options:
  --version             show program's version number and exit
  -h, --help            show this help message and exit
  --config=CONFIG_FILE  Path to configuration XML file
  -v, --verbose         enable verbose logging output [default=False]
  -p NUM_PROCESSORS, --processors=NUM_PROCESSORS
                        Number of processor cores to allocate to chimerascan
                        [default=2]
  --keep-tmp            Do not delete intermediate files from run
  --quals=FMT           FASTQ quality score format [default=sanger]

  Bowtie options:
    Adjust these options to change bowtie alignment settings

    --bowtie-path=BOWTIE_PATH
                        Path to directory containing 'bowtie' [default:
                        assumes bowtie is in the current PATH]
    --multihits=N       Ignore reads that map to more than N locations
                        [default=100]
    --mismatches=N      Aligned reads must have <= N mismatches [default=2]
    --segment-length=N  Size of read segments during discordant alignment
                        phase [default=25]
    --bowtie-args=BOWTIE_ARGS
                        Additional arguments to pass to bowtie aligner (see
                        Bowtie manual for options) [default='--best --strata']
    --trim5=N           Trim N bases from 5' end of read
    --trim3=N           Trim N bases from 3' end of read
    --min-fragment-length=MIN_FRAGMENT_LENGTH
                        Smallest expected fragment length [default=0]
    --max-fragment-length=MAX_FRAGMENT_LENGTH
                        Largest expected fragment length (reads less than this
                        fragment length are assumed to be unspliced and
                        contiguous) [default=1000]
    --library-type=LIBRARY_TYPE
                        Library type [default=fr-unstranded]

  Filtering options:
    Adjust these options to change filtering behavior

    --homology-mismatches=N
                        Number of mismatches to tolerate at breakpoints when
                        computing homology [default=2]
    --anchor-min=N      Minimum breakpoint overlap (bp) required to call
                        spanning reads [default=4]
    --anchor-length=N   Size (bp) of anchor region where mismatch checks are
                        enforced [default=8]
    --anchor-mismatches=N
                        Number of mismatches allowed within anchor region
                        [default=0]
    --filter-cov-wo-spanning=N
                        Filter chimeras lacking weighted coverage >= N when
                        spanning reads are NOT present [default=3]
    --filter-cov-w-spanning=N
                        Filter chimeras lacking weighted coverage >= N when
                        spanning reads ARE present [default=2]
    --filter-isize-percentile=N
                        Filter chimeras when putative insert size is larger
                        than the Nth percentile of the distribution
                        [default=99.9]
}}}

== `Chimerascan` configuration file support ==

Chimerascan supports an XML configuration file containing a run configuration and all command-line options.  All of the XML fields are optional and the command line parameters will always override the XML fields.  At the beginning of each run, a file `runconfig.xml` will be written to the output directory to reflect the exact conglomeration of parameters that were used in that run.

Below is an example working configuration file that may be used as a template:

{{{
<chimerascan_config>
  <output_dir>out</output_dir>
  <fastq_files>
    <file mate="0">read1.fq</file>
    <file mate="1">read2.fq</file>
  </fastq_files>
  <index>myindex</index>
  <num_processors>4</num_processors>
  <quals>illumina</quals>
  <keep_tmp>False</keep_tmp>
  <bowtie_path />
  <bowtie_args>--best --strata</bowtie_args>
  <multihits>100</multihits>
  <mismatches>2</mismatches>
  <segment_length>25</segment_length>
  <trim5>0</trim5>
  <trim3>0</trim3>
  <min_fragment_length>0</min_fragment_length>
  <max_fragment_length>1000</max_fragment_length>
  <library_type>fr-unstranded</library_type>
  <homology_mismatches>2</homology_mismatches>
  <anchor_min>4</anchor_min>
  <anchor_length>8</anchor_length>
  <anchor_mismatches>0</anchor_mismatches>
  <filter_cov_wo_spanning>3</filter_cov_wo_spanning>
  <filter_cov_w_spanning>2</filter_cov_w_spanning>
  <filter_isize_percentile>99.9</filter_isize_percentile>
</chimerascan_config>
}}}